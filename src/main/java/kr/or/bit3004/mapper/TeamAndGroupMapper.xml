<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.or.bit3004.dao.TeamMainDao">
	<select id="getGroupAndTeam" resultType="kr.or.bit3004.groupAndTeam.GroupAndTeam">
		select group_team_no, g.group_no, t.team_no, tm.id, leader, group_name, background_color, group_name, team_name
		  from `group` g
		  join `group_team` gt
		    on g.group_no = gt.group_no
		  join `team` t
		    on gt.team_no = t.team_no
		  join `team_member` tm
		    on t.team_no = tm.team_no
		 where g.id=#{id}
	</select>
	
	<select id="getGroup" resultType="kr.or.bit3004.groupAndTeam.GroupAndTeam">
		select GROUP_NO, GROUP_NAME, id
		  from `group`
		 where id=#{id}
	</select>
	
	<insert id="insertGroup" parameterType="kr.or.bit3004.groupAndTeam.GroupAndTeam">
		insert into `group`(`id`, `group_name`) values(#{id}, #{groupName})
	</insert>
	
	<select id="getCurrGroupNo" resultType="int">
		select max(`GROUP_NO`) from `group`
	</select>
	
	<update id="updateGroupName" parameterType="kr.or.bit3004.groupAndTeam.GroupAndTeam">
		update `group` set `group_name` = #{groupName} where `group_no` = #{groupNo}
	</update>
	
	<select id="searchPersonalNo" resultType="int">
		select group_no from `group` where group_name = 'Personal' and id = #{id}
	</select>
	
	<update id="moveGroup" parameterType="hashMap">
		update `team` set `group_no` = #{1st} where `group_no` = #{2nd}
	</update>
	
	<delete id="delGroup" parameterType="int">
		delete from `group` where `group_no` = #{groupNo}
	</delete>

	<insert id="insertTeam" parameterType="kr.or.bit3004.groupAndTeam.GroupAndTeam">
		insert into `TEAM`(`team_name`, `background_color`) values(#{teamName}, #{backgroundColor})
	</insert>
	
	<insert id="insertTeamLeader" parameterType="kr.or.bit3004.groupAndTeam.GroupAndTeam">
		insert into `TEAM_MEMBER`(`team_no`, `id`, `leader`) values(#{teamNo}, #{id}, 'Y')
	</insert>
	
	<insert id="insertGroupTeam" parameterType="kr.or.bit3004.groupAndTeam.GroupAndTeam">
		insert into `group_team`(group_no, team_no) values(#{groupNo}, #{teamNo})
	</insert>
	
	<select id="getCurrTeamNo" resultType="int">
		select max(`TEAM_NO`) from `TEAM`
	</select>
	
	<update id="moveTeamFromGroup" parameterType="kr.or.bit3004.groupAndTeam.GroupAndTeam">
		update `team` set `group_no` = #{groupNo} where `team_no` = #{teamNo}
	</update>
	
</mapper>
